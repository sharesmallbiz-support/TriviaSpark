import{c as L,a as H,r as T,j as e,X as D}from"./index-BXr8izq5.js";import{u as B}from"./useQuery-C7lBgl7G.js";import{u as z}from"./useMutation-DZTYW-S7.js";import{u as J,L as r,I as m}from"./label-D8k-tJu8.js";import{C as b,a as w,b as S,c as C}from"./card-CiFSfb_x.js";import{B as c}from"./button-Dmd7R46Z.js";import{H as F,A as K,a as O}from"./header-B4dPFlx6.js";import{S as U}from"./separator-BRyQeE80.js";import E from"./footer-DVGCoNRT.js";import{C as Q}from"./calendar-TQCZjxsx.js";import{a as R,S as X}from"./square-pen-DDnz964-.js";import{M as Y}from"./mail-1-WLJ8vd.js";import"./utils-km2FGkQ4.js";import"./brain-Cx9s3D2p.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G=L("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);function me(){var h,p,j,f,N,v,g,y;const{toast:o}=H(),[x,i]=T.useState(!1),{data:s,isLoading:P}=B({queryKey:["/api/auth/me"]}),{register:l,handleSubmit:k,reset:u,formState:{errors:t}}=J(),d=z({mutationFn:async a=>{const n=await fetch("/api/auth/profile",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(a),credentials:"include"});if(!n.ok){const I=await n.json();throw new Error(I.error||"Update failed")}return n.json()},onSuccess:()=>{o({title:"Profile Updated",description:"Your profile has been successfully updated."}),i(!1)},onError:a=>{o({title:"Update Failed",description:a.message,variant:"destructive"})}}),q=a=>{d.mutate(a)},A=()=>{s!=null&&s.user&&u({fullName:s.user.fullName,email:s.user.email,username:s.user.username}),i(!0)},M=()=>{i(!1),u()};return P?e.jsxs("div",{className:"min-h-screen flex flex-col",children:[e.jsx(F,{}),e.jsx("main",{className:"flex-1",children:e.jsx("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:e.jsxs("div",{className:"animate-pulse space-y-6",children:[e.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/3"}),e.jsx("div",{className:"h-64 bg-gray-200 rounded"})]})})}),e.jsx(E,{})]}):e.jsxs("div",{className:"min-h-screen flex flex-col",children:[e.jsx(F,{}),e.jsx("main",{className:"flex-1",children:e.jsxs("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900","data-testid":"text-profile-title",children:"User Profile"}),e.jsx("p",{className:"text-gray-600","data-testid":"text-profile-subtitle",children:"Manage your account information and preferences"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsxs(b,{className:"trivia-card","data-testid":"card-profile-overview",children:[e.jsxs(w,{className:"text-center",children:[e.jsx("div",{className:"flex justify-center mb-4",children:e.jsx(K,{className:"w-24 h-24","data-testid":"avatar-profile",children:e.jsx(O,{className:"wine-gradient text-white text-2xl font-bold",children:((p=(h=s==null?void 0:s.user)==null?void 0:h.fullName)==null?void 0:p.split(" ").map(a=>a[0]).join(""))||"U"})})}),e.jsx(S,{className:"text-xl","data-testid":"text-user-name",children:((j=s==null?void 0:s.user)==null?void 0:j.fullName)||"User"}),e.jsxs("p",{className:"text-gray-600","data-testid":"text-user-username",children:["@",(f=s==null?void 0:s.user)==null?void 0:f.username]})]}),e.jsx(C,{children:e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(Q,{className:"mr-2 h-4 w-4"}),e.jsxs("span",{"data-testid":"text-member-since",children:["Member since ",(N=s==null?void 0:s.user)!=null&&N.createdAt?new Date(s.user.createdAt).toLocaleDateString():"Unknown"]})]})})})]}),e.jsx("div",{className:"lg:col-span-2",children:e.jsxs(b,{className:"trivia-card","data-testid":"card-profile-info",children:[e.jsx(w,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(S,{className:"flex items-center","data-testid":"text-profile-info-title",children:[e.jsx(G,{className:"mr-2 h-5 w-5"}),"Profile Information"]}),!x&&e.jsxs(c,{onClick:A,variant:"outline",size:"sm","data-testid":"button-edit-profile",children:[e.jsx(R,{className:"mr-2 h-4 w-4"}),"Edit"]})]})}),e.jsx(C,{children:x?e.jsxs("form",{onSubmit:k(q),className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(r,{htmlFor:"fullName","data-testid":"label-full-name",children:"Full Name"}),e.jsx(m,{id:"fullName",...l("fullName",{required:"Full name is required"}),className:"mt-1","data-testid":"input-full-name"}),t.fullName&&e.jsx("p",{className:"text-sm text-red-500 mt-1","data-testid":"error-full-name",children:t.fullName.message})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"email","data-testid":"label-email",children:"Email Address"}),e.jsx(m,{id:"email",type:"email",...l("email",{required:"Email is required",pattern:{value:/\S+@\S+\.\S+/,message:"Enter a valid email address"}}),className:"mt-1","data-testid":"input-email"}),t.email&&e.jsx("p",{className:"text-sm text-red-500 mt-1","data-testid":"error-email",children:t.email.message})]}),e.jsxs("div",{children:[e.jsx(r,{htmlFor:"username","data-testid":"label-username",children:"Username"}),e.jsx(m,{id:"username",...l("username",{required:"Username is required"}),className:"mt-1","data-testid":"input-username"}),t.username&&e.jsx("p",{className:"text-sm text-red-500 mt-1","data-testid":"error-username",children:t.username.message})]}),e.jsxs("div",{className:"flex space-x-4",children:[e.jsx(c,{type:"submit",disabled:d.isPending,className:"trivia-button-primary","data-testid":"button-save-profile",children:d.isPending?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin mr-2 h-4 w-4 border-2 border-white border-t-transparent rounded-full"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(X,{className:"mr-2 h-4 w-4"}),"Save Changes"]})}),e.jsxs(c,{type:"button",onClick:M,variant:"outline","data-testid":"button-cancel-edit",children:[e.jsx(D,{className:"mr-2 h-4 w-4"}),"Cancel"]})]})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(r,{className:"text-gray-600",children:"Full Name"}),e.jsx("p",{className:"font-medium mt-1","data-testid":"text-display-full-name",children:((v=s==null?void 0:s.user)==null?void 0:v.fullName)||"Not set"})]}),e.jsx(U,{}),e.jsxs("div",{children:[e.jsx(r,{className:"text-gray-600",children:"Email Address"}),e.jsxs("div",{className:"flex items-center mt-1",children:[e.jsx(Y,{className:"mr-2 h-4 w-4 text-gray-500"}),e.jsx("p",{className:"font-medium","data-testid":"text-display-email",children:((g=s==null?void 0:s.user)==null?void 0:g.email)||"Not set"})]})]}),e.jsx(U,{}),e.jsxs("div",{children:[e.jsx(r,{className:"text-gray-600",children:"Username"}),e.jsxs("p",{className:"font-medium mt-1","data-testid":"text-display-username",children:["@",((y=s==null?void 0:s.user)==null?void 0:y.username)||"Not set"]})]})]})})]})})]})]})}),e.jsx(E,{})]})}export{me as default};
