import{c as R,r as l,l as ne,j as e,m as $,P as k,n as G,o as A,p as oe,s as ce,i as B,d as de,a as le}from"./index-C8fLGFJh.js";import{u as me}from"./useQuery-DueBIpiR.js";import{u as q}from"./useMutation-DDhg2ePi.js";import{C as S,a as E,b as I,c as T}from"./card-GbOed6mg.js";import{B as L}from"./button-dYtoLpIz.js";import{u as ue,L as g,I as P}from"./label-CZbTlGIi.js";import{c as U,R as xe,I as pe}from"./index-BnNznppG.js";import{u as he}from"./index-wXvgX1OJ.js";import{u as fe,S as je,a as ve,b as be,c as ye,d as Ne}from"./select-32HfmKfy.js";import{fU as ge,fe as we,fy as D,eI as Re}from"./schemas-BLpFWpAR.js";import{C as ke}from"./clock-DNm2UMQf.js";import{U as _}from"./users-BrFF6HMn.js";import{T as Ce}from"./trophy-3qvjUIUt.js";import{B as O}from"./brain-C2VL5WdU.js";/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Se=[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]],Ee=R("arrow-right",Se);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ie=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]],Te=R("circle",Ie);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Pe=[["line",{x1:"4",x2:"20",y1:"9",y2:"9",key:"4lhtct"}],["line",{x1:"4",x2:"20",y1:"15",y2:"15",key:"vyu0kd"}],["line",{x1:"10",x2:"8",y1:"3",y2:"21",key:"1ggp8o"}],["line",{x1:"16",x2:"14",y1:"3",y2:"21",key:"weycgp"}]],_e=R("hash",Pe);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ae=[["path",{d:"m16 11 2 2 4-4",key:"9rsbq5"}],["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]],Ge=R("user-check",Ae);var F="Radio",[Fe,V]=$(F),[Me,qe]=Fe(F),J=l.forwardRef((c,r)=>{const{__scopeRadio:a,name:s,checked:i=!1,required:n,disabled:m,value:p="on",onCheck:j,form:v,...b}=c,[o,h]=l.useState(null),u=G(r,N=>h(N)),f=l.useRef(!1),y=o?v||!!o.closest("form"):!0;return e.jsxs(Me,{scope:a,checked:i,disabled:m,children:[e.jsx(k.button,{type:"button",role:"radio","aria-checked":i,"data-state":Y(i),"data-disabled":m?"":void 0,disabled:m,value:p,...b,ref:u,onClick:A(c.onClick,N=>{i||j?.(),y&&(f.current=N.isPropagationStopped(),f.current||N.stopPropagation())})}),y&&e.jsx(H,{control:o,bubbles:!f.current,name:s,value:p,checked:i,required:n,disabled:m,form:v,style:{transform:"translateX(-100%)"}})]})});J.displayName=F;var W="RadioIndicator",K=l.forwardRef((c,r)=>{const{__scopeRadio:a,forceMount:s,...i}=c,n=qe(W,a);return e.jsx(oe,{present:s||n.checked,children:e.jsx(k.span,{"data-state":Y(n.checked),"data-disabled":n.disabled?"":void 0,...i,ref:r})})});K.displayName=W;var Le="RadioBubbleInput",H=l.forwardRef(({__scopeRadio:c,control:r,checked:a,bubbles:s=!0,...i},n)=>{const m=l.useRef(null),p=G(m,n),j=fe(a),v=ce(r);return l.useEffect(()=>{const b=m.current;if(!b)return;const o=window.HTMLInputElement.prototype,u=Object.getOwnPropertyDescriptor(o,"checked").set;if(j!==a&&u){const f=new Event("click",{bubbles:s});u.call(b,a),b.dispatchEvent(f)}},[j,a,s]),e.jsx(k.input,{type:"radio","aria-hidden":!0,defaultChecked:a,...i,tabIndex:-1,ref:p,style:{...i.style,...v,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});H.displayName=Le;function Y(c){return c?"checked":"unchecked"}var De=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],C="RadioGroup",[Oe,nt]=$(C,[U,V]),z=U(),Q=V(),[$e,Be]=Oe(C),X=l.forwardRef((c,r)=>{const{__scopeRadioGroup:a,name:s,defaultValue:i,value:n,required:m=!1,disabled:p=!1,orientation:j,dir:v,loop:b=!0,onValueChange:o,...h}=c,u=z(a),f=he(v),[y,N]=ne({prop:n,defaultProp:i??null,onChange:o,caller:C});return e.jsx($e,{scope:a,name:s,required:m,disabled:p,value:y,onValueChange:N,children:e.jsx(xe,{asChild:!0,...u,orientation:j,dir:f,loop:b,children:e.jsx(k.div,{role:"radiogroup","aria-required":m,"aria-orientation":j,"data-disabled":p?"":void 0,dir:f,...h,ref:r})})})});X.displayName=C;var Z="RadioGroupItem",ee=l.forwardRef((c,r)=>{const{__scopeRadioGroup:a,disabled:s,...i}=c,n=Be(Z,a),m=n.disabled||s,p=z(a),j=Q(a),v=l.useRef(null),b=G(r,v),o=n.value===i.value,h=l.useRef(!1);return l.useEffect(()=>{const u=y=>{De.includes(y.key)&&(h.current=!0)},f=()=>h.current=!1;return document.addEventListener("keydown",u),document.addEventListener("keyup",f),()=>{document.removeEventListener("keydown",u),document.removeEventListener("keyup",f)}},[]),e.jsx(pe,{asChild:!0,...p,focusable:!m,active:o,children:e.jsx(J,{disabled:m,required:n.required,checked:o,...j,...i,name:n.name,ref:b,onCheck:()=>n.onValueChange(i.value),onKeyDown:A(u=>{u.key==="Enter"&&u.preventDefault()}),onFocus:A(i.onFocus,()=>{h.current&&v.current?.click()})})})});ee.displayName=Z;var Ue="RadioGroupIndicator",te=l.forwardRef((c,r)=>{const{__scopeRadioGroup:a,...s}=c,i=Q(a);return e.jsx(K,{...i,...s,ref:r})});te.displayName=Ue;var ae=X,se=ee,Ve=te;const re=l.forwardRef(({className:c,...r},a)=>e.jsx(ae,{className:B("grid gap-2",c),...r,ref:a}));re.displayName=ae.displayName;const w=l.forwardRef(({className:c,...r},a)=>e.jsx(se,{ref:a,className:B("aspect-square h-4 w-4 rounded-full border border-primary text-primary ring-offset-background focus:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",c),...r,children:e.jsx(Ve,{className:"flex items-center justify-center",children:e.jsx(Te,{className:"h-2.5 w-2.5 fill-current text-current"})})}));w.displayName=se.displayName;const Je=we({name:D().min(1,"Name is required").max(50,"Name too long"),teamAction:Re(["none","join","create"]),teamIdentifier:D().max(50,"Team name/number too long").optional()});function ot(){const[,c]=de("/join/:qrCode"),r=c?.qrCode,{toast:a}=le(),[s,i]=l.useState(null),[n,m]=l.useState(null),{register:p,handleSubmit:j,watch:v,setValue:b,formState:{errors:o}}=ue({resolver:ge(Je),defaultValues:{teamAction:"none",name:"",teamIdentifier:""}}),h=v("teamAction");l.useEffect(()=>{r&&(async()=>{try{const x=await fetch(`/api/events/join/${r}/check`,{credentials:"include"});if(x.ok){const d=await x.json();d.returning&&(m(d.participant),i(d))}}catch{}})()},[r]);const{data:u,isLoading:f}=me({queryKey:[`/api/events/${r}/teams-public`],enabled:!!r&&h==="join"&&!s}),y=q({mutationFn:async t=>{const x=await fetch(`/api/events/join/${r}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t),credentials:"include"});if(!x.ok){const d=await x.json();throw new Error(d.error||"Failed to join event")}return x.json()},onSuccess:t=>{i(t),m(t.participant),t.returning?a({title:"Welcome back!",description:`You're already joined as ${t.participant.name}`}):a({title:"Welcome to the event!",description:`You've successfully joined ${t.event.title}`})},onError:t=>{a({title:"Error",description:t.message,variant:"destructive"})}}),N=q({mutationFn:async t=>{const x=await fetch(`/api/participants/${n.id}/team`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({teamId:t}),credentials:"include"});if(!x.ok){const d=await x.json();throw new Error(d.error||"Failed to switch teams")}return x.json()},onSuccess:t=>{m(t),a({title:"Team updated!",description:"You've successfully switched teams"})},onError:t=>{a({title:"Error",description:t.message,variant:"destructive"})}}),ie=t=>{y.mutate(t)},M=t=>{N.mutate(t)};if(n&&s){const t=s.team,x=n.canSwitchTeam;return e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-wine-50 to-champagne-50 flex items-center justify-center p-4",children:e.jsxs(S,{className:"w-full max-w-md trivia-card","data-testid":"card-participant-status",children:[e.jsxs(E,{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 wine-gradient rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(Ge,{className:"h-8 w-8 text-white"})}),e.jsxs(I,{className:"text-2xl wine-text","data-testid":"text-welcome-back-title",children:["Welcome back, ",n.name,"!"]})]}),e.jsxs(T,{className:"space-y-4",children:[e.jsxs("div",{className:"p-4 bg-wine-50 rounded-lg border border-wine-200",children:[e.jsx("h3",{className:"font-semibold text-wine-800 mb-2","data-testid":"text-event-title",children:s.event.title}),e.jsx("p",{className:"text-sm text-gray-600","data-testid":"text-event-description",children:s.event.description})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h4",{className:"font-medium text-gray-800",children:"Team Status"}),t?e.jsx("div",{className:"p-3 bg-champagne-50 rounded-lg border border-champagne-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-champagne-800","data-testid":"text-current-team",children:t.name}),t.tableNumber&&e.jsxs("p",{className:"text-sm text-gray-600",children:["Table ",t.tableNumber]}),e.jsxs("p",{className:"text-xs text-gray-500",children:[t.participantCount,"/",t.maxMembers," members"]})]}),x&&e.jsx(L,{onClick:()=>M(null),variant:"outline",size:"sm","data-testid":"button-leave-team",children:"Leave Team"})]})}):e.jsxs("div",{className:"p-3 bg-gray-50 rounded-lg border border-gray-200",children:[e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"You're not on a team"}),x&&u&&u.length>0&&e.jsxs(je,{onValueChange:M,"data-testid":"select-join-team",children:[e.jsx(ve,{className:"w-full",children:e.jsx(be,{placeholder:"Join a team"})}),e.jsx(ye,{children:u.filter(d=>d.participantCount<d.maxMembers).map(d=>e.jsxs(Ne,{value:d.id,children:[d.name," ",d.tableNumber?`(Table ${d.tableNumber})`:"","(",d.participantCount,"/",d.maxMembers,")"]},d.id))})]})]}),!x&&e.jsxs("div",{className:"flex items-center justify-center text-sm text-amber-600 bg-amber-50 p-3 rounded-lg",children:[e.jsx(ke,{className:"mr-2 h-4 w-4"}),"Team switching is locked (event has started)"]})]}),e.jsxs("div",{className:"space-y-3 pt-4",children:[e.jsxs("div",{className:"flex items-center justify-center text-sm text-gray-600",children:[e.jsx(_,{className:"mr-2 h-4 w-4"}),e.jsx("span",{"data-testid":"text-waiting-message",children:s.event.status==="active"?"Event in progress...":"Waiting for the host to start..."})]}),e.jsx("div",{className:"text-xs text-gray-500 text-center","data-testid":"text-instructions",children:"Keep this page open. The trivia will continue shortly!"})]})]})]})})}return s&&!n?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-wine-50 to-champagne-50 flex items-center justify-center p-4",children:e.jsxs(S,{className:"w-full max-w-md trivia-card","data-testid":"card-joined-success",children:[e.jsxs(E,{className:"text-center",children:[e.jsx("div",{className:"w-16 h-16 wine-gradient rounded-full flex items-center justify-center mx-auto mb-4",children:e.jsx(Ce,{className:"h-8 w-8 text-white"})}),e.jsxs(I,{className:"text-2xl wine-text","data-testid":"text-welcome-title",children:["Welcome, ",s.participant.name,"!"]})]}),e.jsxs(T,{className:"text-center space-y-4",children:[e.jsxs("div",{className:"p-4 bg-wine-50 rounded-lg border border-wine-200",children:[e.jsx("h3",{className:"font-semibold text-wine-800 mb-2","data-testid":"text-event-title",children:s.event.title}),e.jsx("p",{className:"text-sm text-gray-600","data-testid":"text-event-description",children:s.event.description})]}),e.jsxs("div",{className:"space-y-3 pt-4",children:[e.jsxs("div",{className:"flex items-center justify-center text-sm text-gray-600",children:[e.jsx(_,{className:"mr-2 h-4 w-4"}),e.jsx("span",{"data-testid":"text-waiting-message",children:s.event.status==="active"?"Event in progress...":"Waiting for the host to start..."})]}),e.jsx("div",{className:"text-xs text-gray-500","data-testid":"text-instructions",children:"Keep this page open. The trivia will begin shortly!"})]})]})]})}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-wine-50 to-champagne-50 flex items-center justify-center p-4",children:e.jsxs("div",{className:"w-full max-w-md",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsxs("div",{className:"flex items-center justify-center mb-4",children:[e.jsx("div",{className:"w-16 h-16 wine-gradient rounded-lg flex items-center justify-center mr-4",children:e.jsx(O,{className:"text-champagne-400 h-8 w-8"})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold wine-text","data-testid":"text-brand-title",children:"TriviaSpark"}),e.jsx("p",{className:"text-sm text-gray-500","data-testid":"text-brand-tagline",children:"A WebSpark Solution"})]})]}),e.jsx("p",{className:"text-gray-600","data-testid":"text-join-subtitle",children:"Join the trivia event"})]}),e.jsxs(S,{className:"trivia-card","data-testid":"card-join-form",children:[e.jsx(E,{children:e.jsxs(I,{className:"text-center","data-testid":"text-join-title",children:["Event Code: ",e.jsx("span",{className:"font-mono champagne-text",children:r})]})}),e.jsxs(T,{children:[e.jsxs("form",{onSubmit:j(ie),className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(g,{htmlFor:"name","data-testid":"label-name",children:"Your Name *"}),e.jsx(P,{id:"name",...p("name"),placeholder:"Enter your name",className:o.name?"border-red-500":"","data-testid":"input-name"}),o.name&&e.jsx("p",{className:"text-sm text-red-500 mt-1","data-testid":"error-name",children:o.name.message})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(g,{"data-testid":"label-team-options",children:"Team Options"}),e.jsxs(re,{value:h,onValueChange:t=>b("teamAction",t),className:"space-y-3","data-testid":"radio-team-options",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(w,{value:"none",id:"none"}),e.jsx(g,{htmlFor:"none",className:"font-normal",children:"Play individually (no team)"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(w,{value:"join",id:"join"}),e.jsx(g,{htmlFor:"join",className:"font-normal",children:"Join existing team"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(w,{value:"create",id:"create"}),e.jsx(g,{htmlFor:"create",className:"font-normal",children:"Create new team"})]})]}),h==="join"&&e.jsxs("div",{className:"mt-3",children:[e.jsx(g,{htmlFor:"teamIdentifier","data-testid":"label-team-join",children:"Team Name or Table Number"}),e.jsx(P,{id:"teamIdentifier",...p("teamIdentifier"),placeholder:"Enter team name or table number",className:o.teamIdentifier?"border-red-500":"","data-testid":"input-team-join"}),o.teamIdentifier&&e.jsx("p",{className:"text-sm text-red-500 mt-1","data-testid":"error-team-join",children:o.teamIdentifier.message}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:'Example: "Wine Lovers" or "3" for Table 3'})]}),h==="create"&&e.jsxs("div",{className:"mt-3",children:[e.jsx(g,{htmlFor:"teamIdentifier","data-testid":"label-team-create",children:"New Team Name or Table Number"}),e.jsx(P,{id:"teamIdentifier",...p("teamIdentifier"),placeholder:"Enter team name or table number",className:o.teamIdentifier?"border-red-500":"","data-testid":"input-team-create"}),o.teamIdentifier&&e.jsx("p",{className:"text-sm text-red-500 mt-1","data-testid":"error-team-create",children:o.teamIdentifier.message}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:'Example: "Team Awesome" or "5" for Table 5'})]})]}),e.jsx(L,{type:"submit",disabled:y.isPending,className:"w-full trivia-button-primary","data-testid":"button-join-event",children:y.isPending?"Joining...":e.jsxs(e.Fragment,{children:["Join Event",e.jsx(Ee,{className:"ml-2 h-4 w-4"})]})})]}),e.jsxs("div",{className:"mt-6 p-4 bg-gray-50 rounded-lg",children:[e.jsxs("div",{className:"flex items-center text-sm text-gray-600 mb-2",children:[e.jsx(O,{className:"mr-2 h-4 w-4"}),e.jsx("span",{"data-testid":"text-ai-powered",children:"AI-Powered Trivia Experience"})]}),e.jsxs("div",{className:"flex items-center text-xs text-gray-500 mb-1",children:[e.jsx(_,{className:"mr-1 h-3 w-3"}),e.jsx("span",{children:"Teams up to 6 members"})]}),e.jsxs("div",{className:"flex items-center text-xs text-gray-500",children:[e.jsx(_e,{className:"mr-1 h-3 w-3"}),e.jsx("span",{children:"Switch teams before game starts"})]})]})]})]}),e.jsx("div",{className:"text-center mt-6 text-xs text-gray-500","data-testid":"text-footer",children:"Powered by TriviaSpark • Created by Mark Hazleton"})]})})}export{ot as default};
